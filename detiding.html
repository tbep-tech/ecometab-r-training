<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>detiding.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">NERRS Ecosystem Metabolism R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="rbasics.html">R Basics</a>
</li>
<li>
  <a href="detiding.html">Detiding</a>
</li>
<li>
  <a href="odum.html">The Odum method</a>
</li>
<li>
  <a href="using.html">Using metabolism</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="Data_and_Resources.html">
    <span class="fas fa-list"></span>
     
    Data and resources
  </a>
</li>
<li>
  <a href="https://github.com/tbep-tech/ecometab-r-training">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="detiding" class="section level1">
<h1>Detiding</h1>
<p>Get the lesson R script: <a href="detiding.R">detiding.R</a></p>
<p>Get the lesson data: <a href="data/779980.zip">download zip</a></p>
<div id="lesson-outline" class="section level2">
<h2>Lesson Outline</h2>
<ul>
<li><a href="#goals-and-motivation">Goals and Motivation</a></li>
<li>[RStudio]</li>
<li>[R language fundamentals]</li>
<li>[Data structures in R]</li>
<li>[Getting your data into R]</li>
</ul>
</div>
<div id="lesson-exercises" class="section level2">
<h2>Lesson Exercises</h2>
<ul>
<li><a href="#exercise-1">Exercise 1</a></li>
<li><a href="#exercise-2">Exercise 2</a></li>
<li>[Exercise 3]</li>
</ul>
</div>
<div id="goals-and-motivation" class="section level2">
<h2>Goals and Motivation</h2>
<p>This lesson will teach you how to use the <a href="https://cran.r-project.org/web/packages/SWMPr/index.html">SWMPr</a> package to import SWMP data and how to use the <a href="https://github.com/fawda123/wtregdo">WtRegDO</a> package to detide a dissolved oxygen time series. We’ll also be using packages in the tidyverse to wrangle the data for use with the WtRegDO functions. Background information on SWMPr is <a href="https://journal.r-project.org/archive/2016/RJ-2016-015/index.html">here</a> and background information on detiding is <a href="https://aslopubs.onlinelibrary.wiley.com/doi/full/10.1002/lom3.10062">here</a>.</p>
<p>By the end of this lesson, you should know how or find the resources to be able to do the following:</p>
<ul>
<li>Load SWMPr and import data from Apalachicola and Sapelo Island using the <code>import_local</code> function</li>
<li>Clean the SWMP data with <code>qaqc</code> and combine datasets with <code>comb</code></li>
<li>Use the dplyr package to prepare the data for WtRegDO</li>
<li>Understand if dissolved oxygen is correlated with tide and how WtRegDO “removes” the tidal signal</li>
<li>Use WtRegDO to detide the DO time series</li>
</ul>
</div>
<div id="data-import-with-swmpr" class="section level2">
<h2>Data import with SWMPr</h2>
<p>Last time we got comfortable with R basics by exploring how to get around the RStudio console, understanding the basics of the R language, and importing datasets for analysis. Now that we have the basics out of the way, we can use some existing packages to work specifically with SWMP data.</p>
<p>The SWMPr package was developed a few years ago to provide a bridge between the raw data and the R analysis platform. It does this with some degree of success, but by far it’s most useful feature is being able to import and combine time series from SWMP sites with relative ease. In particular, the <code>import_local</code>, <code>qaqc</code>, and <code>comb</code> functions allow us to quickly import, clean up, and combine datasets for follow-up analysis. This is all we’ll do with SWMPr in these lessons.</p>
<p>The <code>import_local</code> function is designed to work with data downloaded from the CDMO using the “Zip Downloads” feature from the Advanced Query System: <a href="http://cdmo.baruch.sc.edu/aqs/zips.cfm" class="uri">http://cdmo.baruch.sc.edu/aqs/zips.cfm</a>. The filfes we have in our “data” folder was requested from this feature for all datasets from Apalachicola and Sapelo Island from 2017 to 2019.</p>
<p>The <code>import_local</code> function has two arguments: <code>path</code> to indicate where the data are located and <code>station_code</code> to indicate which station to import. We first load SWMPr and then use the function to import data for Apalachicola Dry Bar station:</p>
<pre class="r"><code># load SWMPr
library(SWMPr)

# import data
apadbwq &lt;- import_local(path = &#39;data&#39;, station_code = &#39;apadbwq&#39;)

# characteristics of the dataset
head(apadbwq)</code></pre>
<pre><code>##         datetimestamp temp f_temp spcond f_spcond  sal f_sal do_pct f_do_pct
## 1 2017-01-01 00:00:00 15.9    &lt;0&gt;  34.99      &lt;0&gt; 22.1   &lt;0&gt;  104.1      &lt;0&gt;
## 2 2017-01-01 00:15:00 15.9    &lt;0&gt;  34.94      &lt;0&gt; 22.0   &lt;0&gt;  104.0      &lt;0&gt;
## 3 2017-01-01 00:30:00 15.9    &lt;0&gt;  34.90      &lt;0&gt; 22.0   &lt;0&gt;  103.5      &lt;0&gt;
## 4 2017-01-01 00:45:00 15.9    &lt;0&gt;  34.94      &lt;0&gt; 22.0   &lt;0&gt;  103.3      &lt;0&gt;
## 5 2017-01-01 01:00:00 15.9    &lt;0&gt;  34.99      &lt;0&gt; 22.1   &lt;0&gt;  104.1      &lt;0&gt;
## 6 2017-01-01 01:15:00 15.9    &lt;0&gt;  35.08      &lt;0&gt; 22.1   &lt;0&gt;  103.9      &lt;0&gt;
##   do_mgl f_do_mgl depth f_depth cdepth f_cdepth level f_level clevel f_clevel
## 1    9.0      &lt;0&gt;  1.88     &lt;0&gt;   1.81      &lt;3&gt;    NA    &lt;-1&gt;     NA     &lt;NA&gt;
## 2    9.0      &lt;0&gt;  1.88     &lt;0&gt;   1.81      &lt;3&gt;    NA    &lt;-1&gt;     NA     &lt;NA&gt;
## 3    9.0      &lt;0&gt;  1.89     &lt;0&gt;   1.82      &lt;3&gt;    NA    &lt;-1&gt;     NA     &lt;NA&gt;
## 4    8.9      &lt;0&gt;  1.89     &lt;0&gt;   1.83      &lt;3&gt;    NA    &lt;-1&gt;     NA     &lt;NA&gt;
## 5    9.0      &lt;0&gt;  1.90     &lt;0&gt;   1.84      &lt;3&gt;    NA    &lt;-1&gt;     NA     &lt;NA&gt;
## 6    9.0      &lt;0&gt;  1.90     &lt;0&gt;   1.84      &lt;3&gt;    NA    &lt;-1&gt;     NA     &lt;NA&gt;
##    ph f_ph turb f_turb chlfluor f_chlfluor
## 1 8.3  &lt;0&gt;   15    &lt;0&gt;       NA       &lt;-1&gt;
## 2 8.2  &lt;0&gt;   15    &lt;0&gt;       NA       &lt;-1&gt;
## 3 8.3  &lt;0&gt;   13    &lt;0&gt;       NA       &lt;-1&gt;
## 4 8.3  &lt;0&gt;   16    &lt;0&gt;       NA       &lt;-1&gt;
## 5 8.3  &lt;0&gt;   10    &lt;0&gt;       NA       &lt;-1&gt;
## 6 8.3  &lt;0&gt;   14    &lt;0&gt;       NA       &lt;-1&gt;</code></pre>
<pre class="r"><code>dim(apadbwq)</code></pre>
<pre><code>## [1] 105120     25</code></pre>
<pre class="r"><code>range(apadbwq$datetimestamp)</code></pre>
<pre><code>## [1] &quot;2017-01-01 00:00:00 EST&quot; &quot;2019-12-31 23:45:00 EST&quot;</code></pre>
<p>Note that this function was able to import and combine data from multiple csv files. We would have had to do this by hand if we were importing data with more general import functions available in R (e.g., <code>read_csv()</code> from last time).</p>
</div>
<div id="cleaning-and-combining-swmp-data" class="section level2">
<h2>Cleaning and combining SWMP data</h2>
<p>Each row has data for multiple parameters at 15 minute intervals. Each parameter also includes a column with QAQC flags, i.e., <code>f_</code> then the parameter name. We can then use the <code>qaqc</code> function to “screen” observations with specific QAQC flags. You can view what the flags mean at this website: <a href="http://cdmo.baruch.sc.edu/data/qaqc.cfm" class="uri">http://cdmo.baruch.sc.edu/data/qaqc.cfm</a>. We typically want to only use data that have the “0” flag, meaning it has passed initial QAQC checks. Other flags can be kept by adding them to the <code>qaqc_keep</code> argument. You can view a tabular summary of the flags in a dataset using the <code>qaqcchk</code> function.</p>
<pre class="r"><code># keep only observations that passed qaqc chekcs
apadbwq &lt;- qaqc(apadbwq, qaqc_keep = &#39;0&#39;)

# check the results
head(apadbwq)</code></pre>
<pre><code>##         datetimestamp temp spcond  sal do_pct do_mgl depth cdepth level clevel
## 1 2017-01-01 00:00:00 15.9  34.99 22.1  104.1    9.0  1.88     NA    NA     NA
## 2 2017-01-01 00:15:00 15.9  34.94 22.0  104.0    9.0  1.88     NA    NA     NA
## 3 2017-01-01 00:30:00 15.9  34.90 22.0  103.5    9.0  1.89     NA    NA     NA
## 4 2017-01-01 00:45:00 15.9  34.94 22.0  103.3    8.9  1.89     NA    NA     NA
## 5 2017-01-01 01:00:00 15.9  34.99 22.1  104.1    9.0  1.90     NA    NA     NA
## 6 2017-01-01 01:15:00 15.9  35.08 22.1  103.9    9.0  1.90     NA    NA     NA
##    ph turb chlfluor
## 1 8.3   15       NA
## 2 8.2   15       NA
## 3 8.3   13       NA
## 4 8.3   16       NA
## 5 8.3   10       NA
## 6 8.3   14       NA</code></pre>
<pre class="r"><code>dim(apadbwq)</code></pre>
<pre><code>## [1] 105120     13</code></pre>
<pre class="r"><code>range(apadbwq$datetimestamp)</code></pre>
<pre><code>## [1] &quot;2017-01-01 00:00:00 EST&quot; &quot;2019-12-31 23:45:00 EST&quot;</code></pre>
<p>Notice that the number of rows are the same as before - no rows are removed by <code>qaqc</code> to retain the timesteps. Values that did not fit the screening criteria are given a <code>NA</code> value. Also notice the flag columns are removed.</p>
<p>Now we can repeat the steps above to import and clean data from the weather station at Apalachicola.</p>
<pre class="r"><code># import weather data, clean it up
apaebmet &lt;- import_local(path = &#39;data&#39;, station_code = &#39;apaebmet&#39;)
apaebmet &lt;- qaqc(apaebmet, qaqc_keep = &#39;0&#39;)

# check the results
head(apaebmet)</code></pre>
<pre><code>##         datetimestamp atemp rh   bp wspd maxwspd wdir sdwdir totpar totprcp
## 1 2017-01-01 00:00:00  15.7 89 1020  4.8     6.7   97     10      0       0
## 2 2017-01-01 00:15:00  15.8 90 1020  4.9     6.5  103      9      0       0
## 3 2017-01-01 00:30:00  16.1 91 1020  3.8     5.8  107     11      0       0
## 4 2017-01-01 00:45:00  16.5 92 1019  3.3     6.4  119     15      0       0
## 5 2017-01-01 01:00:00  16.9 93 1019  5.3     8.6  113      9      0       0
## 6 2017-01-01 01:15:00  17.3 93 1019  3.9     5.6  118     10      0       0
##   totsorad
## 1       NA
## 2       NA
## 3       NA
## 4       NA
## 5       NA
## 6       NA</code></pre>
<pre class="r"><code>dim(apaebmet)</code></pre>
<pre><code>## [1] 105120     11</code></pre>
<pre class="r"><code>range(apaebmet$datetimestamp)</code></pre>
<pre><code>## [1] &quot;2017-01-01 00:00:00 EST&quot; &quot;2019-12-31 23:45:00 EST&quot;</code></pre>
<p>The <code>comb</code> function in SWMPr lets us combine data from two locations using the <code>datetimestamp</code> column. We’ll need to do this to use the functions in the WtRegDO package that require both water quality and weather data.</p>
<p>There are a couple of arguments to consider when using the <code>comb</code> function. First, the <code>timestep</code> argument defines the time step for the resulting output. Keep this at 15 to retain all of the data. You could use a larger time step to subset the data if, for example, we data only every 60 minutes. Second, the <code>method</code> argument defines how two datasets with different date ranges are combined. Use <code>method = 'union'</code> to retain the entire date range across both datasets or use <code>method = 'intersect'</code> to retain only the dates that include data from both datasets. For our example, <code>union</code> and <code>intersect</code> produce the same results since the date ranges are the same.</p>
<pre class="r"><code># combine water quality and weather data
apa &lt;- comb(apadbwq, apaebmet, timestep = 15, method = &#39;union&#39;)

# check the results
head(apa)</code></pre>
<pre><code>##         datetimestamp temp spcond  sal do_pct do_mgl depth cdepth level clevel
## 1 2017-01-01 00:00:00 15.9  34.99 22.1  104.1    9.0  1.88     NA    NA     NA
## 2 2017-01-01 00:15:00 15.9  34.94 22.0  104.0    9.0  1.88     NA    NA     NA
## 3 2017-01-01 00:30:00 15.9  34.90 22.0  103.5    9.0  1.89     NA    NA     NA
## 4 2017-01-01 00:45:00 15.9  34.94 22.0  103.3    8.9  1.89     NA    NA     NA
## 5 2017-01-01 01:00:00 15.9  34.99 22.1  104.1    9.0  1.90     NA    NA     NA
## 6 2017-01-01 01:15:00 15.9  35.08 22.1  103.9    9.0  1.90     NA    NA     NA
##    ph turb chlfluor atemp rh   bp wspd maxwspd wdir sdwdir totpar totprcp
## 1 8.3   15       NA  15.7 89 1020  4.8     6.7   97     10      0       0
## 2 8.2   15       NA  15.8 90 1020  4.9     6.5  103      9      0       0
## 3 8.3   13       NA  16.1 91 1020  3.8     5.8  107     11      0       0
## 4 8.3   16       NA  16.5 92 1019  3.3     6.4  119     15      0       0
## 5 8.3   10       NA  16.9 93 1019  5.3     8.6  113      9      0       0
## 6 8.3   14       NA  17.3 93 1019  3.9     5.6  118     10      0       0
##   totsorad
## 1       NA
## 2       NA
## 3       NA
## 4       NA
## 5       NA
## 6       NA</code></pre>
<pre class="r"><code>dim(apa)</code></pre>
<pre><code>## [1] 105120     23</code></pre>
<pre class="r"><code>range(apa$datetimestamp)</code></pre>
<pre><code>## [1] &quot;2017-01-01 00:00:00 EST&quot; &quot;2019-12-31 23:45:00 EST&quot;</code></pre>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise 1</h2>
<p>Repeat the above examples but do this using data for Sapelo Island. Import data for <code>sapdcwq</code> and <code>sapmlmet</code>, clean them up with <code>qaqc</code>, and combine them with <code>comb</code>.</p>
<ol style="list-style-type: decimal">
<li>Open a new script in your RStudio project, save it with an informative title (e.g, <code>import-detiding.R</code>), and add a section header with <code>Ctrl + Shift + R</code>. 1. Load the SWMPr package with the <code>library</code> function.</li>
<li>Import and clean up <code>sapdcwq</code> with <code>import_local</code> and <code>qaqc</code>.</li>
<li>Import and clean up <code>sapmlmet</code> with <code>import_local</code> and <code>qaqc</code>.</li>
<li>Combine the two with <code>comb</code>. Keep the time step at 15 minutes and use the <code>union</code> option.</li>
</ol>
</div>
<div id="preparing-swmp-data-for-detiding" class="section level2">
<h2>Preparing SWMP data for detiding</h2>
<p>Now we want to setup our data for use with functions in the WtRegDO package. As with most R functions, the input formats are very specific requiring us to make sure the column names, locations, and types of columns in our data are exactly as needed. The two functions in WtRegDO that we’ll use in this lesson are <code>evalcor</code> and <code>wtreg</code>. You can look at the examples in the help file to see what format we need.</p>
<p>The WtRegDO package comes with an example dataset that has a format we can model for our SWMP data. First we load WtRegDO and then examine the <code>SAPDC</code> example dataset. This is the same site we used for the previous exercise, just with older data.</p>
<pre class="r"><code># load WtRegDO
library(WtRegDO)

# view first six rows of SAPDC
head(SAPDC)</code></pre>
<pre><code>##         DateTimeStamp Temp  Sal DO_obs ATemp   BP WSpd      Tide
## 1 2012-01-01 00:00:00 14.9 33.3    5.0  11.9 1022  0.5 0.8914295
## 2 2012-01-01 00:30:00 14.9 33.4    5.5  11.3 1022  0.6 1.0011830
## 3 2012-01-01 01:00:00 14.9 33.4    5.9   9.9 1021  0.6 1.0728098
## 4 2012-01-01 01:30:00 14.8 33.3    6.4  10.0 1022  2.4 1.1110885
## 5 2012-01-01 02:00:00 14.7 33.2    6.6  11.4 1022  1.3 1.1251628
## 6 2012-01-01 02:30:00 14.7 33.3    6.1  10.7 1021  0.0 1.1223799</code></pre>
<pre class="r"><code># View the structure of SAPDC
str(SAPDC)</code></pre>
<pre><code>## &#39;data.frame&#39;:    17568 obs. of  8 variables:
##  $ DateTimeStamp: POSIXct, format: &quot;2012-01-01 00:00:00&quot; &quot;2012-01-01 00:30:00&quot; ...
##  $ Temp         : num  14.9 14.9 14.9 14.8 14.7 14.7 14.6 14.6 14.4 14.2 ...
##  $ Sal          : num  33.3 33.4 33.4 33.3 33.2 33.3 33.4 33.4 33.3 33.3 ...
##  $ DO_obs       : num  5 5.5 5.9 6.4 6.6 6.1 5.7 5.2 4.6 4 ...
##  $ ATemp        : num  11.9 11.3 9.9 10 11.4 10.7 10.2 8.9 10.4 11 ...
##  $ BP           : num  1022 1022 1021 1022 1022 ...
##  $ WSpd         : num  0.5 0.6 0.6 2.4 1.3 0 0 0 0 0 ...
##  $ Tide         : num  0.891 1.001 1.073 1.111 1.125 ...</code></pre>
<p>We can compare this to our Apalachicola dataset from before.</p>
<pre class="r"><code># view first six rows of apa
head(apa)</code></pre>
<pre><code>##         datetimestamp temp spcond  sal do_pct do_mgl depth cdepth level clevel
## 1 2017-01-01 00:00:00 15.9  34.99 22.1  104.1    9.0  1.88     NA    NA     NA
## 2 2017-01-01 00:15:00 15.9  34.94 22.0  104.0    9.0  1.88     NA    NA     NA
## 3 2017-01-01 00:30:00 15.9  34.90 22.0  103.5    9.0  1.89     NA    NA     NA
## 4 2017-01-01 00:45:00 15.9  34.94 22.0  103.3    8.9  1.89     NA    NA     NA
## 5 2017-01-01 01:00:00 15.9  34.99 22.1  104.1    9.0  1.90     NA    NA     NA
## 6 2017-01-01 01:15:00 15.9  35.08 22.1  103.9    9.0  1.90     NA    NA     NA
##    ph turb chlfluor atemp rh   bp wspd maxwspd wdir sdwdir totpar totprcp
## 1 8.3   15       NA  15.7 89 1020  4.8     6.7   97     10      0       0
## 2 8.2   15       NA  15.8 90 1020  4.9     6.5  103      9      0       0
## 3 8.3   13       NA  16.1 91 1020  3.8     5.8  107     11      0       0
## 4 8.3   16       NA  16.5 92 1019  3.3     6.4  119     15      0       0
## 5 8.3   10       NA  16.9 93 1019  5.3     8.6  113      9      0       0
## 6 8.3   14       NA  17.3 93 1019  3.9     5.6  118     10      0       0
##   totsorad
## 1       NA
## 2       NA
## 3       NA
## 4       NA
## 5       NA
## 6       NA</code></pre>
<pre class="r"><code># view the structure of apa
str(apa)</code></pre>
<pre><code>## Classes &#39;swmpr&#39; and &#39;data.frame&#39;:    105120 obs. of  23 variables:
##  $ datetimestamp: POSIXct, format: &quot;2017-01-01 00:00:00&quot; &quot;2017-01-01 00:15:00&quot; ...
##  $ temp         : num  15.9 15.9 15.9 15.9 15.9 15.9 15.9 15.9 15.9 15.9 ...
##  $ spcond       : num  35 34.9 34.9 34.9 35 ...
##  $ sal          : num  22.1 22 22 22 22.1 22.1 22.1 22.2 22.2 22.2 ...
##  $ do_pct       : num  104 104 104 103 104 ...
##  $ do_mgl       : num  9 9 9 8.9 9 9 8.9 9 9 8.9 ...
##  $ depth        : num  1.88 1.88 1.89 1.89 1.9 1.9 1.93 1.94 1.94 1.97 ...
##  $ cdepth       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ level        : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ clevel       : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ ph           : num  8.3 8.2 8.3 8.3 8.3 8.3 8.2 8.3 8.3 8.2 ...
##  $ turb         : num  15 15 13 16 10 14 21 13 13 15 ...
##  $ chlfluor     : num  NA NA NA NA NA NA NA NA NA NA ...
##  $ atemp        : num  15.7 15.8 16.1 16.5 16.9 17.3 18 18.3 18.3 18.4 ...
##  $ rh           : num  89 90 91 92 93 93 93 94 94 95 ...
##  $ bp           : num  1020 1020 1020 1019 1019 ...
##  $ wspd         : num  4.8 4.9 3.8 3.3 5.3 3.9 5.3 5.1 3.9 3.8 ...
##  $ maxwspd      : num  6.7 6.5 5.8 6.4 8.6 5.6 6.8 7.4 5.2 5.5 ...
##  $ wdir         : num  97 103 107 119 113 118 128 124 121 129 ...
##  $ sdwdir       : num  10 9 11 15 9 10 8 7 7 8 ...
##  $ totpar       : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ totprcp      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ totsorad     : num  NA NA NA NA NA NA NA NA NA NA ...
##  - attr(*, &quot;station&quot;)= chr [1:2] &quot;apadbwq&quot; &quot;apaebmet&quot;
##  - attr(*, &quot;parameters&quot;)= chr [1:22] &quot;temp&quot; &quot;spcond&quot; &quot;sal&quot; &quot;do_pct&quot; ...
##  - attr(*, &quot;qaqc_cols&quot;)= logi FALSE
##  - attr(*, &quot;cens_cols&quot;)= logi FALSE
##  - attr(*, &quot;date_rng&quot;)= POSIXct[1:2], format: &quot;2017-01-01 00:00:00&quot; &quot;2019-12-31 23:45:00&quot;
##  - attr(*, &quot;timezone&quot;)= chr &quot;America/Jamaica&quot;
##  - attr(*, &quot;stamp_class&quot;)= chr [1:2] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<p>So, we need to do a few things to our Apalachicola dataset to make it look like SAPDC. We can use functions from the dplyr package to “wrangle” the data into the correct format. The dplyr package comes with the tidyverse. All we need to do is rename the columns and select only those that are relevant. This can all be done with the <code>select</code> function in dplyr.</p>
<pre class="r"><code># load dplyr
library(dplyr)

# select and rename columns
apa &lt;- select(apa,
  DateTimeStamp = datetimestamp, 
  Temp = temp, 
  Sal = sal, 
  DO_obs = do_mgl,
  ATemp = atemp, 
  BP = bp, 
  WSpd = wspd, 
  Tide = depth
)

# show first six rows
head(apa)</code></pre>
<pre><code>##         DateTimeStamp Temp  Sal DO_obs ATemp   BP WSpd Tide
## 1 2017-01-01 00:00:00 15.9 22.1    9.0  15.7 1020  4.8 1.88
## 2 2017-01-01 00:15:00 15.9 22.0    9.0  15.8 1020  4.9 1.88
## 3 2017-01-01 00:30:00 15.9 22.0    9.0  16.1 1020  3.8 1.89
## 4 2017-01-01 00:45:00 15.9 22.0    8.9  16.5 1019  3.3 1.89
## 5 2017-01-01 01:00:00 15.9 22.1    9.0  16.9 1019  5.3 1.90
## 6 2017-01-01 01:15:00 15.9 22.1    9.0  17.3 1019  3.9 1.90</code></pre>
<pre class="r"><code># view structure
str(apa)</code></pre>
<pre><code>## Classes &#39;swmpr&#39; and &#39;data.frame&#39;:    105120 obs. of  8 variables:
##  $ DateTimeStamp: POSIXct, format: &quot;2017-01-01 00:00:00&quot; &quot;2017-01-01 00:15:00&quot; ...
##  $ Temp         : num  15.9 15.9 15.9 15.9 15.9 15.9 15.9 15.9 15.9 15.9 ...
##  $ Sal          : num  22.1 22 22 22 22.1 22.1 22.1 22.2 22.2 22.2 ...
##  $ DO_obs       : num  9 9 9 8.9 9 9 8.9 9 9 8.9 ...
##  $ ATemp        : num  15.7 15.8 16.1 16.5 16.9 17.3 18 18.3 18.3 18.4 ...
##  $ BP           : num  1020 1020 1020 1019 1019 ...
##  $ WSpd         : num  4.8 4.9 3.8 3.3 5.3 3.9 5.3 5.1 3.9 3.8 ...
##  $ Tide         : num  1.88 1.88 1.89 1.89 1.9 1.9 1.93 1.94 1.94 1.97 ...</code></pre>
<p>Finally, we need to deal with pesky missing data values. Most functions in R deal with missing data by either not working at all or providing some work-around to accommodate the missing values. The functions in WtRegDO fall in the former category.</p>
<p>Missing data in SWMP are not uncommon and they often occur when sondes or other equipment are down for maintenance or are otherwise broken for a period of time. So, missing observations usually come in blocks where all parameters are unavailable, as opposed to only one parameter. We can quickly remove rows with missing data using the <code>na.omit</code> function. Note that this will remove an entire row where even one parameter is missing data. Usually this is not ideal for most data, but this is okay for our examples because we require all parameters at a time step to estimate metabolism.</p>
<p>Here we see an example of a chunk of missing observations.</p>
<pre class="r"><code>apa[which(is.na(apa$Tide))[1:5], ]</code></pre>
<pre><code>##            DateTimeStamp Temp Sal DO_obs ATemp   BP WSpd Tide
## 2920 2017-01-31 09:45:00   NA  NA     NA  16.6 1025  1.9   NA
## 4946 2017-02-21 12:15:00   NA  NA     NA  20.8 1017  6.5   NA
## 4947 2017-02-21 12:30:00   NA  NA     NA  20.7 1017  6.7   NA
## 4948 2017-02-21 12:45:00   NA  NA     NA  20.7 1016  5.6   NA
## 4949 2017-02-21 13:00:00   NA  NA     NA  20.5 1016  4.3   NA</code></pre>
<p>Now we just remove the rows with missing data using <code>na.omit</code>.</p>
<pre class="r"><code># number of rows before
nrow(apa)</code></pre>
<pre><code>## [1] 105120</code></pre>
<pre class="r"><code># omit missing rows
apa &lt;- na.omit(apa)

# number of rows after
nrow(apa)</code></pre>
<pre><code>## [1] 47587</code></pre>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise 2</h2>
<p>Repeat the above examples but use the combined dataset for Sapelo Island that you created in <a href="#exercise-1">Exercise 1</a>.</p>
<ol style="list-style-type: decimal">
<li>Create a new section in your script using <code>Ctrl + Shift + r</code>.</li>
<li>Load the dplyr package with the library function.</li>
<li>Simultaneously rename and select the water temperature (<code>Temp</code>), salinity (<code>Sal</code>), dissolved oxygen (<code>DO_obs</code>), air temperature (<code>Atemp</code>), air pressure (<code>BP</code>), wind speed (<code>WSpd</code>), and tidal height (<code>Tide</code>) columns in the Sapelo Island dataset with the <code>select</code> function from dplyr.</li>
<li>Remove missing rows with <code>na.omit</code>.</li>
</ol>
</div>
<div id="what-is-and-why-detiding" class="section level2">
<h2>What is and why detiding</h2>
</div>
<div id="using-wtregdo-to-detide" class="section level2">
<h2>Using WtRegDO to detide</h2>
</div>
<div id="how-well-did-it-work" class="section level2">
<h2>How well did it work?</h2>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
